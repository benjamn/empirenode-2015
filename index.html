<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">

    <title>Meteor += ECMAScript</title>

    <meta name="description" content="Meteor += ECMAScript">
    <meta name="author" content="Ben Newman">

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/benjamn.css" id="theme">
    <link rel="stylesheet" href="plugin/highlight/default.min.css">
    <link rel="stylesheet" type="text/css" href="css/overrides.css">

    <!-- Code syntax highlighting -->
    <link rel="stylesheet" href="lib/css/xcode.css">

    <script src="plugin/highlight/highlight.min.js"></script>
  </head>

  <body>
    <img class="branding" src="img/meteor-logo-mark-black-on-transparent.png" />

    <div class="reveal">

      <!-- Any section element inside of this container is displayed as a slide -->
      <div class="slides">
        <section>
          <h1>Meteor += ECMAScript</h1>
          <p>
            <a target="_blank" href="mailto:ben@meteor.com">Ben Newman</a>
            <br>
            <a target="_blank"
               href="http://www.meetup.com/Meteor-SFBay/events/223586835/">30 July 2015</a>
            <br><br>
            <pre class="contact">
{ <a target="_blank" href="http://github.com/benjamn">github</a>,
  <a target="_blank" href="http://twitter.com/benjamn">twitter</a>,
  <a target="_blank" href="http://instagram.com/benjamn">instagram</a>,
  <a target="_blank" href="http://facebook.com/benjamn">facebook</a>
}.com/benjamn
            </pre>
            <br>
            <pre class="contact">
<a target="_blank"
   href="http://benjamn.github.io/devshop-july-2015">benjamn.github.io/devshop-july-2015</a></pre>
          </p>
        </section>

        <section>
          <h2>
            Have you ever tried describing Meteor
            <span class="fragment">without mentioning JavaScript?</span>
          </h2>
        </section>

        <section>
          <h2>
            The <span class="fragment">JavaScript</span> App Platform
          </h2>
        </section>

        <section>
          <h2>
            Meteor is a complete open source platform
            <span class="fragment">for building web and mobile apps</span>
            <span class="fragment">in pure JavaScript</span>
          </h2>
        </section>

        <section>
          <h2>
            What are we talking about<span class="fragment"><br>when we talk
            about JavaScript?</span>
          </h2>
        </section>

        <section>
          <h2>
            The language that runs in web
            browsers<span class="fragment">, the one that hasn't changed
            all that much since the early 2000s?</span>
          </h2>
        </section>

        <section>
          <h2>
            The language that puts the &ldquo;JS&rdquo;<br>
            <span class="fragment">in Node.JS?</span>
          </h2>
          <p class="fragment">
            But which version of Node?
          </p>
        </section>

        <section>
          <h3>
            How much of the standard library actually works according to
            the specification?
          </h3>
        </section>

        <section>
          <h3>
            Which specification<br>
            are we talking about?
          </h3>
        </section>

        <section>
          <h3>
            Can you run the same code<br>
            in a web browser?
          </h3>
        </section>

        <section>
          <h3>
            What kind of module system<br>
            does Meteor support?
          </h3>
        </section>

        <section>
          <h3>
            What is this about <code>Fiber</code>s?
          </h3>
        </section>

        <section>
          <h2>
            These questions have answers!
          </h2>
        </section>

        <section>
          <h2>
            The most valuable property of any programming language:
          </h2>
          <br>
          <p class="fragment">
            Everyone can agree precisely what will happen when a computer
            runs a program written in that language.
          </p>
        </section>

        <section>
          <h2>
            &ldquo;JavaScript&rdquo; conveys much of the necessary information
          </h2>
          <br>
          <p class="fragment">
            Even if it's a little vague<span class="fragment">, a vast
            audience of programmers still know it by that
            name</span><span class="fragment">, and that's why we keep
            using it.</span>
          </p>
        </section>

        <section>
          <h2>
            But programming languages<br>
            can change<span class="fragment">,
            and JavaScript is changing faster than ever!</span>
          </h2>
        </section>

        <section>
          <h3>
            Now easier than ever to propose new language
            features<span class="fragment">, build consensus around
            <a target="_blank"
               href="https://github.com/tc39/ecma262/blob/master/README.md">those
            proposals</a></span><span class="fragment">, and get them
            implemented.</span>
          </h3>
          <br>
          <p class="fragment">
            <code>RegExp.escape</code> revived on
            <a target="_blank"
            href="https://esdiscuss.org/topic/regexp-escape"><code>es-discuss</code></a>
            last month, presented in this week's TC39 meeting.
          </p>
        </section>

        <section>
          <h3>
            The code behind the <code>meteor</code> command-line tool has
            been using ECMAScript 2015 features for some time now.
          </h3>
          <br>
          <p class="fragment">
            And it's great.
          </p>
        </section>

        <section>
          <section>
            <h2>
              How great?
            </h2>
            <div class="align-left">
              <code class="javascript block small fragment">
function JsFile() {
  InputFile.apply(this, arguments);
}

JsFile.prototype = Object.create(InputFile.prototype);
JsFile.prototype.constructor = JsFile;

JsFile.prototype.addJavaScript = function (options) {
  this._minifiedFiles.push({
    data: options.data,
    sourceMap: options.sourceMap,
    path: options.path
  });
};

exports.JsFile = JsFile;</code>
            </div>
          </section>

          <section>
            <h2>
              How great?
            </h2>
            <div class="align-left">
              <code class="javascript block small">
function JsFile() {
  InputFile.apply(this, arguments);
}

Meteor._inherits(JsFile, InputFile);


JsFile.prototype.addJavaScript = function (options) {
  this._minifiedFiles.push({
    data: options.data,
    sourceMap: options.sourceMap,
    path: options.path
  });
};

exports.JsFile = JsFile;</code>
            </div>
          </section>

          <section>
            <h2>
              How great?
            </h2>
            <div class="align-left">
              <code class="javascript block small">
class JsFile extends InputFile {
  constructor() {
    InputFile.apply(this, arguments);
  }
}


JsFile.prototype.addJavaScript = function (options) {
  this._minifiedFiles.push({
    data: options.data,
    sourceMap: options.sourceMap,
    path: options.path
  });
};

exports.JsFile = JsFile;</code>
            </div>
          </section>

          <section>
            <h2>
              How great?
            </h2>
            <div class="align-left">
              <code class="javascript block small">
class JsFile extends InputFile {
  constructor() {
    super(...arguments);
  }
}


JsFile.prototype.addJavaScript = function (options) {
  this._minifiedFiles.push({
    data: options.data,
    sourceMap: options.sourceMap,
    path: options.path
  });
};

exports.JsFile = JsFile;</code>
            </div>
          </section>

          <section>
            <h2>
              How great?
            </h2>
            <div class="align-left">
              <code class="javascript block small">
class JsFile extends InputFile {
  constructor() {
    super(...arguments);
  }

  addJavaScript(options) {
    this._minifiedFiles.push({
      data: options.data,
      sourceMap: options.sourceMap,
      path: options.path
    });
  }
}

exports.JsFile = JsFile;
              </code>
            </div>
          </section>

          <section>
            <h2>
              How great?
            </h2>
            <div class="align-left">
              <code class="javascript block small">
class JsFile extends InputFile {




  addJavaScript(options) {
    this._minifiedFiles.push({
      data: options.data,
      sourceMap: options.sourceMap,
      path: options.path
    });
  }
}

exports.JsFile = JsFile;
              </code>
            </div>
          </section>

          <section>
            <h2>
              How great?
            </h2>
            <div class="align-left">
              <code class="javascript block small">
class JsFile extends InputFile {
  addJavaScript(options) {
    this._minifiedFiles.push({
      data: options.data,
      sourceMap: options.sourceMap,
      path: options.path
    });
  }
}

exports.JsFile = JsFile;




              </code>
            </div>
          </section>

          <section>
            <h2>
              How great?
            </h2>
            <div class="align-left">
              <code class="javascript block small">
class JsFile extends InputFile {
  addJavaScript({ data, sourceMap, path }) {
    this._minifiedFiles.push({
      data: data,
      sourceMap: sourceMap,
      path: path
    });
  }
}

exports.JsFile = JsFile;




              </code>
            </div>
          </section>

          <section>
            <h2>
              How great?
            </h2>
            <div class="align-left">
              <code class="javascript block small">
class JsFile extends InputFile {
  addJavaScript({ data, sourceMap, path }) {
    this._minifiedFiles.push({
      data,
      sourceMap,
      path,
    });
  }
}

exports.JsFile = JsFile;




              </code>
            </div>
          </section>

          <section>
            <h2>
              How great?
            </h2>
            <div class="align-left">
              <code class="javascript block small">
class JsFile extends InputFile {
  addJavaScript({ data, sourceMap, path }) {
    this._minifiedFiles.push({ data, sourceMap, path });
  }
}

exports.JsFile = JsFile;








              </code>
            </div>
          </section>

          <section>
            <h2>
              How great?
            </h2>
            <div class="align-left">
              <code class="javascript block small">
export class JsFile extends InputFile {
  addJavaScript({ data, sourceMap, path }) {
    this._minifiedFiles.push({ data, sourceMap, path });
  }
}










              </code>
            </div>
          </section>

          <section>
            <h2>
              How great?
            </h2>
            <div class="align-left">
              <code class="javascript block small">
export class JsFile extends InputFile {
  addJavaScript({ data, sourceMap = null, path }) {
    this._minifiedFiles.push({ data, sourceMap, path });
  }
}










              </code>
            </div>
          </section>
        </section>

        <section>
          <h2>
            We're pretty addicted.
          </h2>
          <br>
          <p class="fragment">
            And we want you to have the same development experience.
          </p>
        </section>

        <section>
          <h2>
            How?
          </h2>
          <br>
          <code class="bash fragment">meteor add ecmascript</code>
          <br><br>
          <p class="fragment">
            Just a package that can be added to any
            app<br><span class="fragment"> or <code>api.use</code>d by any
            package</span><span class="fragment">, and it will be
            installed by default for all new apps and packages.</span>
          </p>
        </section>

        <section>
          <h2>
            So what dialect of JavaScript does Meteor implement?
          </h2>
          <br>
          <p class="fragment">
            Easy!<span class="fragment"> The latest
            one:</span><strong class="fragment"> ECMAScript
            2015</strong><span class="fragment">+</span>
          </p>
        </section>

        <section>
          <h2>
            Our commitment:
          </h2>
          <br>
          <p class="fragment">
            The <code>ecmascript</code> package will provide any and all
            language features that can be faithfully compiled to code that
            runs natively in all JavaScript engines.
          </p>
        </section>

        <section>
          <h2>
            Two kinds of progress:
          </h2>
          <br>
          <ol>
            <li class="fragment">
              Meteor provides simulated support for features not yet
              implemented natively in all JavaScript engines.
              <br><br>
            </li>
            <li class="fragment">
              Native support catches up to the simulation.
            </li>
          </ol>
          <br><br>
          <p class="fragment">
            Code you write in the first stage should not have to be
            rewritten when the second stage arrives.
          </p>
        </section>

        <section class="fixed-height">
          <section>
            <h2>
              Example: <span class="fragment"><code>for</code>-<code>of</code>
              loops</span>
            </h2>
            <code class="javascript block small fragment">
let sum = 0;
for (let x of arrayOfNumbers) {
  sum += x;
}</code>
            <p class="fragment">
              gets transpiled to
            </p>
            <code class="javascript block small fragment">
var sum = 0;
var _iter = arrayOfNumbers[Symbol.iterator](), _result;
while (! (_result = _iter.next()).done) {
  var x = _result.value;
  sum += x;
}</code>
            <p class="fragment">
              <code>Symbol.iterator</code> is a special kind of unique
              property name that cannot be simulated faithfully.
            </p>
          </section>

          <section>
            <h2>
              Example: <code>for</code>-<code>of</code> loops
            </h2>
            <code class="javascript block small">
var sum = 0;
var _iter = arrayOfNumbers[Symbol.iterator](), _result;
while (! (_result = _iter.next()).done) {
  var x = _result.value;
  sum += x;
}</code>
            <p class="fragment">
              assumes a minimal <code>Symbol</code> implementation:
            </p>
            <div class="align-left">
              <code class="javascript block small fragment">
if (typeof Symbol === "undefined") {
  Symbol = function Symbol() {};
}



              </code>
            </div>
          </section>

          <section>
            <h2>
              Example: <code>for</code>-<code>of</code> loops
            </h2>
            <code class="javascript block small">
var sum = 0;
var _iter = arrayOfNumbers[Symbol.iterator](), _result;
while (! (_result = _iter.next()).done) {
  var x = _result.value;
  sum += x;
}</code>
            <p>
              assumes a minimal <code>Symbol</code> implementation:
            </p>
            <div class="align-left">
              <code class="javascript block small">
if (typeof Symbol === "undefined") {
  Symbol = function Symbol() {};
}

if (! Symbol.iterator) {
  Symbol.iterator = "@@iterator";
}</code>
            </div>
          </section>

          <section>
            <h2>
              Example: <code>for</code>-<code>of</code> loops
            </h2>
            <code class="javascript block small">
var sum = 0;
var _iter = arrayOfNumbers[Symbol.iterator](), _result;
while (! (_result = _iter.next()).done) {
  var x = _result.value;
  sum += x;
}</code>
            <p>
              assumes a minimal <code>Symbol</code> implementation:
            </p>
            <div class="align-left">
              <code class="javascript block small">
if (typeof Symbol === "undefined") {
  Symbol = function Symbol() {}; // Fake!
}

if (! Symbol.iterator) {
  Symbol.iterator = "@@iterator"; // Fake!
}</code>
            </div>
          </section>
        </section>

        <section>
          <h3>
            Since the original <code>for</code>-<code>of</code> loop works
            today in translation<span class="fragment">, and it will continue
            to work natively once it no longer needs to be
            translated</span><span class="fragment">,
            <code>for</code>-<code>of</code> loops meet our criteria for
            inclusion in the <code>ecmascript</code>
            package</span><span class="fragment">,
            while <code>Symbol</code>s do not.</span>
          </h3>
        </section>

        <section class="fixed-height">
          <h2>
            Example: <code class="fragment">Array.prototype</code>
          </h2>
          <br>
          <p class="fragment">
            <code>Array</code> methods
            like <code>.forEach</code>, <code>.map</code>,
            and <code>.reduce</code> are now available in <em>almost</em>
            every JavaScript engine<span class="fragment">, except
            Internet Explorer 8 and earlier.</span>
          </p>
          <br>
          <p class="fragment">
            We use a popular polyfill library called
            <a target="_blank"
               href="https://github.com/es-shims/es5-shim"><code>es5-shim</code></a>
            to implement these methods<span class="fragment">, but
            there is no way to make them <em>non-enumerable</em>
            in IE8.</span>
          </p>
        </section>

        <section class="fixed-height">
          <h2>
            Example: <code>Array.prototype</code>
          </h2>
          <br>
          <p class="fragment">
            If you ever use a <code>for</code>-<code>in</code> loop to
            iterate over an array in IE8, you'll get all those method
            names, too!
          </p>
          <div class="align-left">
            <code class="javascript block small fragment">
let sparseArray = [];
sparseArray[0] = "a";
sparseArray[2] = "c";

for (let index in sparseArray) {
  console.log(index); // Should log 0 and 2.
}
            </code>
          </div>
          <p class="fragment">
            Normally you would be out of luck<span class="fragment">, but
            Meteor can actually fix this for you.</span>
          </p>
        </section>

        <section class="fixed-height">
          <h2>
            Example: <code>Array.prototype</code>
          </h2>
          <br>
          <p>
            If you ever use a <code>for</code>-<code>in</code> loop to
            iterate over an array in IE8, you'll get all those method
            names, too!
          </p>
          <div class="align-left">
            <code class="javascript block small">
let sparseArray = [];
sparseArray[0] = "a";
sparseArray[2] = "c";

for (let index in runtime.sanitizeForInObject(sparseArray)) {
  console.log(index); // Should log 0 and 2.
}
            </code>
          </div>
          <p>
            Normally you would be out of luck, but Meteor can actually fix
            this for you.
          </p>
        </section>

        <section class="fixed-height">
          <h2>
            Example: <code>Array.prototype</code>
          </h2>
          <br>
          <p>
            If you ever use a <code>for</code>-<code>in</code> loop to
            iterate over an array in IE8, you'll get all those method
            names, too!
          </p>
          <div class="align-left">
            <code class="javascript block small">
let sparseArray = [];
sparseArray[0] = "a";
sparseArray[2] = "c";

for (let index in runtime.sanitizeForInObject(sparseArray)) {
  console.log(index); // Should log 0 and 2.
}
            </code>
          </div>
          <p>
            In most browsers, the <code>sanitizeForInObject</code> helper
            function simply returns its argument.
          </p>
        </section>

        <section class="fixed-height">
          <h2>
            Example: <code>Array.prototype</code>
          </h2>
          <br>
          <p>
            If you ever use a <code>for</code>-<code>in</code> loop to
            iterate over an array in IE8, you'll get all those method
            names, too!
          </p>
          <div class="align-left">
            <code class="javascript block small">
let sparseArray = [];
sparseArray[0] = "a";
sparseArray[2] = "c";

for (let index in runtime.sanitizeForInObject(sparseArray)) {
  console.log(index); // Should log 0 and 2.
}
            </code>
          </div>
          <p>
            In IE8, <span class="fragment">when the argument is an
            array, </span><span class="fragment">it returns a new object
            containing only the enumerable keys.</span>
          </p>
        </section>

        <section class="fixed-height">
          <h2>
            Example: <code class="fragment">Promise</code><code class="fragment">.Fiber</code>
          </h2>
          <code class="javascript block small fragment">
// Replace Promise.prototype.then with a wrapper that ensures the
// onResolved and onRejected callbacks always run in a Fiber.
var es6PromiseThen = Promise.prototype.then;














          </code>
        </section>

        <section class="fixed-height">
          <h2>
            Example: <code>Promise.Fiber</code>
          </h2>
          <code class="javascript block small">
// Replace Promise.prototype.then with a wrapper that ensures the
// onResolved and onRejected callbacks always run in a Fiber.
var es6PromiseThen = Promise.prototype.then;

Promise.prototype.then = function then(onResolved, onRejected) {











};
          </code>
        </section>

        <section class="fixed-height">
          <h2>
            Example: <code>Promise.Fiber</code>
          </h2>
          <code class="javascript block small">
// Replace Promise.prototype.then with a wrapper that ensures the
// onResolved and onRejected callbacks always run in a Fiber.
var es6PromiseThen = Promise.prototype.then;

Promise.prototype.then = function then(onResolved, onRejected) {
  var Promise = this.constructor;










};
          </code>
        </section>

        <section class="fixed-height">
          <h2>
            Example: <code>Promise.Fiber</code>
          </h2>
          <code class="javascript block small">
// Replace Promise.prototype.then with a wrapper that ensures the
// onResolved and onRejected callbacks always run in a Fiber.
var es6PromiseThen = Promise.prototype.then;

Promise.prototype.then = function then(onResolved, onRejected) {
  var Promise = this.constructor;

  if (typeof Promise.Fiber === "function") {





  }


};
          </code>
        </section>

        <section class="fixed-height">
          <h2>
            Example: <code>Promise.Fiber</code>
          </h2>
          <code class="javascript block small">
// Replace Promise.prototype.then with a wrapper that ensures the
// onResolved and onRejected callbacks always run in a Fiber.
var es6PromiseThen = Promise.prototype.then;

Promise.prototype.then = function then(onResolved, onRejected) {
  var Promise = this.constructor;

  if (typeof Promise.Fiber === "function") {
    return es6PromiseThen.call(
      this,
      wrapCallback(onResolved, Promise),
      wrapCallback(onRejected, Promise)
    );
  }


};
          </code>
        </section>

        <section class="fixed-height">
          <h2>
            Example: <code>Promise.Fiber</code>
          </h2>
          <code class="javascript block small">
// Replace Promise.prototype.then with a wrapper that ensures the
// onResolved and onRejected callbacks always run in a Fiber.
var es6PromiseThen = Promise.prototype.then;

Promise.prototype.then = function then(onResolved, onRejected) {
  var Promise = this.constructor;

  if (typeof Promise.Fiber === "function") {
    return es6PromiseThen.call(
      this,
      wrapCallback(onResolved, Promise),
      wrapCallback(onRejected, Promise)
    );
  }

  return es6PromiseThen.call(this, onResolved, onRejected);
};
          </code>
          <p class="fragment">
            Good <code>Promise</code> tutorials:
            <a class="fragment" target="_blank"
               href="http://www.html5rocks.com/en/tutorials/es6/promises/">HTML5Rocks</a><span class="fragment">,
            <a target="_blank"
               href="http://www.2ality.com/2014/10/es6-promises-api.html">2ality</a></span>
          </p>
        </section>

        <section class="fixed-height">
          <h2>
            Example: <code>Promise.Fiber</code>
          </h2>
          <code class="javascript block small">
function wrapCallback(callback, Promise) {
  var fiber = Promise.Fiber.current;
  var dynamics = fiber && fiber._meteorDynamics;

  return callback && function (arg) {
    return fiberPool.run({
      callback: callback,
      args: [arg], // Avoid dealing with arguments objects.
      dynamics: dynamics
    }, Promise);
  };
}
          </code>
          <p class="fragment">
            <code>Fiber</code>s are recycled using a
            <a target="_blank"
               href="https://github.com/meteor/promise/blob/master/fiber_pool.js">pool</a>,
            so a new <code>Fiber</code> does not have to be created
            every time a <code>Promise</code> callback fires.
          </p>
        </section>

        <section class="fixed-height">
          <h2>
            Example: <code>Promise.Fiber</code>
          </h2>
          <code class="javascript block small">
function wrapCallback(callback, Promise) {
  var fiber = Promise.Fiber.current;
  var dynamics = fiber && fiber._meteorDynamics;

  return callback && function (arg) {
    return fiberPool.run({
      callback: callback,
      args: [arg], // Avoid dealing with arguments objects.
      dynamics: dynamics
    }, Promise);
  };
}
          </code>
          <p>
            Even better,
            <span class="fragment"><code>Fiber._meteorDynamics</code> is
            saved and restored when the callback
            runs,</span><span class="fragment"> so you never have to
            call <code>Meteor.bindEnvironment</code> with
            <code>Promise</code>s.</span>
          </p>
        </section>

        <section class="fixed-height">
          <section>
            <h2>
              What about source maps?
            </h2>
            <img class="fragment" src="img/with_source_maps.png">
          </section>

          <section>
            <h2>
              No source maps?
            </h2>
            <img src="img/without_source_maps.png">
          </section>
        </section>

        <section>
          <h2>
            We believe...
          </h2>
          <br>
          <p class="fragment">
            You shouldn't have to wait for native support before you start
            using the latest ECMAScript features.
          </p>
          <p class="fragment">
            Nor should you to have to wonder when it's safe to transition
            from simulated to native support.
          </p>
          <p class="fragment">
            Nor should you to have to find the best way to integrate
            libraries like <code>es5-shim</code> with tools like
            <a target="_blank"
               href="https://babeljs.io">Babel</a><span class="fragment">,
            especially when the difference is only apparent in IE8!</span>
          </p>
        </section>

        <section>
          <h2>
            The Meteor advantage
          </h2>
          <br>
          <p class="fragment">
            Because Meteor provides a complete platform out of the
            box<span class="fragment">, including compilation, packaging,
            and delivery of scripts, libraries, source maps, and other
            assets</span><span class="fragment">, we are in a powerful
            position to make the transition to ECMAScript 2015+ as
            seamless as possible.</span>
          </p>
        </section>

        <section>
          <h2>
            That, <span class="fragment">more than
            anything, </span><span class="fragment">is why I left my job
            at Facebook</span>
          </h2>
          <br>
          <p class="fragment">
            They have these posters up everywhere that say things like
            &ldquo;Focus on Impact,&rdquo; so that's what I did.
          <p>
          <p class="fragment">
            I believe Meteor has the best chance<span class="fragment"> of
            providing the best experience</span><span class="fragment">
            for developing apps with the latest version of
            JavaScript.</span>
          </p>
          <p class="fragment">
            And there are a whole lot more of you than there are engineers
            at Facebook.
          </p>
        </section>

        <section data-background="img/wires.jpg">
          <h1 class="thanks">Thanks!</h1>
        </section>
      </div>
    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>
    <script src="js/init.js"></script>
  </body>
</html>
